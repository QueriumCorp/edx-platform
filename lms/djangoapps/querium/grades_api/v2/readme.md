Willo API Sample Usage
=====

## LTI launch parameters

Necessary parameters can be retrieved from each LTI launch. Parameters used in the examples below are represented in the LTI launch as the following:

```
context_id=4469701c1aad450891edf449942cb25b
ext_content_item_service_url=https://stage.willolabs.com/api/v1/links/BBKQyB/4469701c1aad450891edf449942cb25b/
ext_wl_outcome_service_url=https://stage.willolabs.com/api/v1/outcomes/BBKQyB/4469701c1aad450891edf449942cb25b/
user_id=a03a9d1d8aad172d5fcc29e5300dd935d695c0e3
```

## Access token

Access token is generated by Willo Labs staff for each application.

## Scenario: Create gradebook column and push student grades

Interact with the service at `ext_wl_outcome_service_url` to create LMS gradebook columns and push student grades.

### Create a gradebook column for tutorial

```
curl -v -X POST https://stage.willolabs.com/api/v1/outcomes/BBKQyB/4469701c1aad450891edf449942cb25b/ \
    -H "Content-Type: application/vnd.willolabs.outcome.activity+json" \
    -H "Authorization: Token sampleaccesstoken" \
    -d \
'{
    "type": "activity",
    "id": "tutorial-avoiding-plagiarism",
    "title": "Tutorial: Avoiding Plagiarism",
    "description": "sample description",
    "due_date": "2019-06-01T00:00:00+04:00",
    "points_possible": 100
}'
```

### Get list of gradebook columns created by previous API calls

```
curl -X GET https://stage.willolabs.com/api/v1/outcomes/BBKQyB/4469701c1aad450891edf449942cb25b/ \
    -H "Accept: application/vnd.willolabs.outcome.activitylist+json" \
    -H "Authorization: Token sampleaccesstoken"
```

### Pushing grades to LMS for a student

```
curl -v -X POST https://stage.willolabs.com/api/v1/outcomes/BBKQyB/4469701c1aad450891edf449942cb25b/ \
    -H "Content-Type: application/vnd.willolabs.outcome.result+json" \
    -H "Authorization: Token sampleaccesstoken" \
    -d \
'{
    "type": "result",
    "id": "8627ec7e1215413385f10b20d0dde4f0",
    "activity_id": "tutorial-avoiding-plagiarism",
    "user_id": "523bd4baaf772a615a478397d560a1591c7e3347",
    "result_date": "2019-05-04T16:59:01.938229+00:00",
    "score": 100,
    "points_possible": 100
}'
```

### Retrieve current grade for a student

```
curl -v -X GET "https://stage.willolabs.com/api/v1/outcomes/BBKQyB/4469701c1aad450891edf449942cb25b/?id=tutorial-avoiding-plagiarism&user_id=523bd4baaf772a615a478397d560a1591c7e3347" \
    -H "Accept: application/vnd.willolabs.outcome.result+json" \
    -H "Authorization: Token sampleaccesstoken"
```

## Scenario: Create gradable deep links and push student grades

Interact with the services at `ext_content_item_service_url` and `ext_wl_outcome_service_url` to create gradable deep links and push student grades.

### Retrieve list of LMS modules

```
curl -H "Authorization: Token sampleaccesstoken" https://stage.willolabs.com/api/v1/links/BBKQyB/4469701c1aad450891edf449942cb25b/
```

### Create new LMS module to hold deep links

```
curl -v -X POST https://stage.willolabs.com/api/v1/links/BBKQyB/4469701c1aad450891edf449942cb25b/ \
    -H "Content-Type: application/json" \
    -H "Authorization: Token sampleaccesstoken" \
    -d \
'{
    "title": "Tutorials"
}'
```

Response:

```
{
  "links": [
    {
      "href": "https://stage.willolabs.com/api/v1/links/BBKQyB/4469701c1aad450891edf449942cb25b/module/579/",
      "rel": "self"
    }
  ],
  "name": "Tutorials",
  "title": "Tutorials"
}
```

### Create tutorial links in newly created module

```
curl -v -X POST https://stage.willolabs.com/api/v1/links/BBKQyB/4469701c1aad450891edf449942cb25b/module/579/ \
    -H "Content-Type: application/json" \
    -H "Authorization: Token sampleaccesstoken" \
    -d \
'{
  "type": "ltiLink",
  "id": "conducting-experimental-research",
  "title": "Tutorial: Conducting Experimental Eesearch",
  "url": "https://example.com/lti/launch",
  "points_possible": 100,
  "due_date": "2019-06-01T00:00:00+04:00",
  "custom": {
    "custom_tutorial": "conducting-experimental-research"
  }
}'
```

### Pushing grades to LMS for a student

```
curl -v -X POST https://stage.willolabs.com/api/v1/outcomes/BBKQyB/4469701c1aad450891edf449942cb25b/ \
    -H "Content-Type: application/vnd.willolabs.outcome.result+json" \
    -H "Authorization: Token sampleaccesstoken" \
    -d \
'{
    "type": "result",
    "id": "76fc568fdd4e4635af1ad5b3985d7238",
    "activity_id": "conducting-experimental-research",
    "user_id": "523bd4baaf772a615a478397d560a1591c7e3347",
    "result_date": "2019-05-04T16:59:01.938229+00:00",
    "score": 100,
    "points_possible": 100
}'
```


## WILLO LABS
## GRADE SYNC API

### JULY 2018
### SECURITY & AUTHORIZATION
HTTPS-only
To ensure security, the Willo Labs Grade Sync API is available only via HTTPS.
Authorization Keys
All requests to the Grade Sync API must include an authorization key that is specific to your organization account. Multiple authorization keys can be generated and used simultaneously. You may revoke an authorization key at any time.
#### MAKING REQUESTS
Service URL
Requests to the Grade Sync API must be made to a course-specific service URL, which is supplied to tool providers on launches. The service URL will be provided in the parameter: ext_wl_outcome_service_url
** Example: **
ext_wl_outcome_service_url=https://test.willolabs.com/api/v1/outcomes/9b3a73/
Future versions of the Grade Sync API may require explicit instructor permission to manage grades in the LMS course.
Request Headers
Requests to the Grade Sync API must include an Authorization header, containing an API Key. API keys can be obtained, revoked, and managed using your Willo Labs login. Requests that do not include a valid Authorization header, or do not supply a valid API Key, will result in a HTTP 4xx response.
Authorization: Token <API_KEY>

Requests to the Grade Sync API should include a Content-Type and Accept header, as appropriate.
Content-Type: application/vnd.willolabs.outcome.activity+json
Content-Type: application/vnd.willolabs.outcome.result+json
Accept: application/json
#### Defining Activities
Activities correspond to gradebook columns, are defined using the following structure:
```
{
    "type": "activity",
    "id": "d3c1b00e539f45b0a9f6b78aa817c6d0",
    "title": "title",
    "description": "description",
    "due_date": "2017-07-12T15:47:32+00:00",
    "points_possible": 100
}
```
#### Defining student results
Results correspond to individual student grades:
```
{
    "type": "result",
    "id": "8627ec7e1215413385f10b20d0dde4f0",
    "activity_id": "d3c1b00e539f45b0a9f6b78aa817c6d0",
    "user_id": "4242dd82-9acb-4784-9eba-01c55591963f",
    "result_date": "2017-07-12T15:47:32+00:00",
    "score": 97,
    "points_possible": 100
}
```


### HANDLING RESPONSES
#### Status codes
400 Bad Request: request not formatted correctly or missing required field(s), activity not found, or user not found
401 Unauthorized: invalid authorization header or access token
403 Forbidden: no permission to add grades to course
404 Not Found: service url not valid
502 Bad Gateway: received error from LMS
504 Gateway Timeout: connection to LMS timed out
#### OPERATIONS
Create or update gradebook column
POST <serviceurl>
Content-Type: application/vnd.willolabs.outcome.activity+json
Responses:
200 OK: LMS gradebook column already exists
201 Created: LMS gradebook column has been created
Create or update student result
POST <serviceurl>
Content-Type: application/vnd.willolabs.outcome.result+json
Responses:
200 OK: Score has been updated in LMS gradebook
Get gradebook column
GET <serviceurl>
Content-Type: application/vnd.willolabs.outcome.activity+json
Responses:
200 OK: LMS gradebook column information available
```
{
    "name": "title",
    "description": "description",
    "points_possible": 100
}
```
#### Get student result
GET <serviceurl>
Content-Type: application/vnd.willolabs.outcome.result+json
Responses:
200 OK: User and Assignment found, grade information displayed if available
```
{
    "points_possible": 4,
    "score": 3,
    "timestamp": "2019-03-27T16:26:50.164363",
    "due_date": "12019-03-27T16:26:50.164363",
    "comments": "comments here",
}
```

## Grade Module

McDaniel Nov-2019
work notes

### Pulling grade data - api:
===================
/edx/app/edxapp/edx-platform/lms/djangoapps/grades/api/v1/
current fully-implemented source: https://github.com/edx/edx-platform/blob/master/lms/djangoapps/grades/rest_api/v1/urls.py

### Example V2 Grades api calls:
===============
- Enrollment: https://dev.roverbyopenstax.org/grades_api/v2/courses/course-v1:ABC+OS9471721_9626+01/
- Enrollment Section: https://dev.roverbyopenstax.org/grades_api/v2/courses/course-v1:ABC+OS9471721_9626+01/c0a9afb73af311e98367b7d76f928163/
- Enrollment Homework: https://dev.roverbyopenstax.org/grades_api/v2/courses/course-v1:ABC+OS9471721_9626+01/c0a9afb73af311e98367b7d76f928163/02ecb4993af311e9816bb7d76f928163/


### other interesting apis:
===================
course about api: https://dev.roverbyopenstax.org/api/courses/v1/courses/course-v1:ABC+OS9471721_9626+01/

https://dev.roverbyopenstax.org/api/courses/v1/courses/course-v1:ABC+OS9471721_9626+01
https://dev.roverbyopenstax.org/api/courses/v1/blocks/course-v1:OpenStax+OS9471720_20dc+Spring2019_mcdaniel_MWF800-850
https://dev.roverbyopenstax.org/api/user/v1/me
https://am.dev.roverbyopenstax.org/api/user/v1/me
https://am.dev.roverbyopenstax.org/api/user/v1/preferences/mcdaniel
https://am.dev.roverbyopenstax.org/api/v1/course_runs/

